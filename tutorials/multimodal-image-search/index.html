
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Lexy is a data platform for building AI applications." name="description"/>
<link href="https://getlexy.com/tutorials/multimodal-image-search/" rel="canonical"/>
<link href="../basic-rag/" rel="prev"/>
<link href="../custom-transformers/" rel="next"/>
<link href="../../assets/public/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.5.15" name="generator"/>
<title>Multimodal image search - Lexy AI</title>
<link href="../../assets/stylesheets/main.7e359304.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-GXKGDFL4B1"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-GXKGDFL4B1",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-GXKGDFL4B1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="pink" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#multimodal-image-search">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Lexy AI" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Lexy AI">
<img alt="logo" src="../../assets/public/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Lexy AI
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Multimodal image search
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="pink" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="pink" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/lexy-ai/lexy" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"></path></svg>
</div>
<div class="md-source__repository">
    lexy-ai/lexy
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Lexy AI" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Lexy AI">
<img alt="logo" src="../../assets/public/logo.png"/>
</a>
    Lexy AI
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/lexy-ai/lexy" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"></path></svg>
</div>
<div class="md-source__repository">
    lexy-ai/lexy
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../installation/">
<span class="md-ellipsis">
    Installation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../quickstart/">
<span class="md-ellipsis">
    Quickstart
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Tutorials
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../basic-rag/">
<span class="md-ellipsis">
    Retrieval Augmented Generation (RAG)
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Multimodal image search
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Multimodal image search
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#create-collection">
<span class="md-ellipsis">
      Create collection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-index-and-binding">
<span class="md-ellipsis">
      Create index and binding
    </span>
</a>
<nav aria-label="Create index and binding" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#define-index">
<span class="md-ellipsis">
      Define index
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-binding">
<span class="md-ellipsis">
      Create binding
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-images-to-the-collection">
<span class="md-ellipsis">
      Upload images to the collection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#query-index">
<span class="md-ellipsis">
      Query index
    </span>
</a>
<nav aria-label="Query index" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#query-by-text">
<span class="md-ellipsis">
      Query by text
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#query-by-image">
<span class="md-ellipsis">
      Query by image
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../custom-transformers/">
<span class="md-ellipsis">
    Custom transformers
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../document-filters/">
<span class="md-ellipsis">
    Document filters
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../structured-data-extraction/">
<span class="md-ellipsis">
    Structured data extraction
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/rest-api/">
<span class="md-ellipsis">
    REST API
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Python SDK
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Python SDK
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/lexy_py/binding/">
<span class="md-ellipsis">
    Binding
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/lexy_py/client/">
<span class="md-ellipsis">
    Client
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/lexy_py/collection/">
<span class="md-ellipsis">
    Collection
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/lexy_py/document/">
<span class="md-ellipsis">
    Document
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/lexy_py/filters/">
<span class="md-ellipsis">
    Filters
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/lexy_py/indexes/">
<span class="md-ellipsis">
    Index
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/lexy_py/transformer/">
<span class="md-ellipsis">
    Transformer
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributing/">
<span class="md-ellipsis">
    Contributing
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../faq/">
<span class="md-ellipsis">
    FAQ
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#create-collection">
<span class="md-ellipsis">
      Create collection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-index-and-binding">
<span class="md-ellipsis">
      Create index and binding
    </span>
</a>
<nav aria-label="Create index and binding" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#define-index">
<span class="md-ellipsis">
      Define index
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-binding">
<span class="md-ellipsis">
      Create binding
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-images-to-the-collection">
<span class="md-ellipsis">
      Upload images to the collection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#query-index">
<span class="md-ellipsis">
      Query index
    </span>
</a>
<nav aria-label="Query index" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#query-by-text">
<span class="md-ellipsis">
      Query by text
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#query-by-image">
<span class="md-ellipsis">
      Query by image
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="multimodal-image-search">Multimodal image search</h1>
<p>In this tutorial, we'll walk through how to use Lexy to create a multimodal search application. We'll use the <a href="https://openai.com/blog/clip/">CLIP</a> model from OpenAI to create embeddings for images, and then use those embeddings to find matching images for a given text query, or vice versa.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">lexy_py</span> <span class="kn">import</span> <span class="n">LexyClient</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">lx</span> <span class="o">=</span> <span class="n">LexyClient</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="create-collection">Create collection</h2>
<p>Let's first create a collection to store our images. We'll use the <strong><code>images_tutorial</code></strong> collection for this tutorial.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># create a new collection</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">images_tutorial</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span><span class="s1">'images_tutorial'</span><span class="p">)</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="n">images_tutorial</span>
</span></code></pre></div>
<div class="language-text no-copy result highlight" id="code-output"><pre><span></span><code><span id="__span-code-output-1"><a href="#__codelineno-code-output-1" id="__codelineno-code-output-1" name="__codelineno-code-output-1"></a>&lt;Collection('images_tutorial', description='None')&gt;
</span></code></pre></div>
<h2 id="create-index-and-binding">Create index and binding</h2>
<h3 id="define-index">Define index</h3>
<p>First we'll define our index to store our embedded images. We use <strong><code>*.embeddings.clip</code></strong> as the transformer model name
to indicate that we want to use the CLIP embeddings model, but that the embedding field can use any model that matches
this pattern, including <strong><code>image.embeddings.clip</code></strong> and <strong><code>text.embeddings.clip</code></strong>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># define index fields</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">index_fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="s2">"embedding"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"embedding"</span><span class="p">,</span> <span class="s2">"extras"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"dims"</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="s2">"model"</span><span class="p">:</span> <span class="s2">"*.embeddings.clip"</span><span class="p">}},</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="p">}</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="c1"># create index</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="n">idx</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>    <span class="n">index_id</span><span class="o">=</span><span class="s1">'image_tutorial_index'</span><span class="p">,</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="n">description</span><span class="o">=</span><span class="s1">'Index for images tutorial'</span><span class="p">,</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>    <span class="n">index_fields</span><span class="o">=</span><span class="n">index_fields</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="p">)</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="n">idx</span>
</span></code></pre></div>
<div class="language-text no-copy result highlight" id="code-output"><pre><span></span><code><span id="__span-code-output-1"><a href="#__codelineno-code-output-1" id="__codelineno-code-output-1" name="__codelineno-code-output-1"></a>&lt;Index('image_tutorial_index', description='Index for images tutorial')&gt;
</span></code></pre></div>
<p>We'll use the CLIP image embeddings transformer available on <a href="https://huggingface.co/openai/clip-vit-base-patch32">HuggingFace</a>. This transformer uses the <a href="https://openai.com/blog/clip/">CLIP</a> model from OpenAI to create embeddings for images.</p>
<p>The CLIP model is a transformer model that was trained on a large dataset of images and text pairs. The model learns to map images and text to a shared embedding space, where the embeddings of matching images and text are close together. We can use this model to create embeddings for images, and then use those embeddings to find matching images for a given text query, or vice versa.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">lx</span><span class="o">.</span><span class="n">transformers</span>
</span></code></pre></div>
<div class="language-text no-copy result highlight" id="code-output"><pre><span></span><code><span id="__span-code-output-1"><a href="#__codelineno-code-output-1" id="__codelineno-code-output-1" name="__codelineno-code-output-1"></a>[&lt;Transformer('image.embeddings.clip', description='Embed images using 'openai/clip-vit-base-patch32'.')&gt;,
</span><span id="__span-code-output-2"><a href="#__codelineno-code-output-2" id="__codelineno-code-output-2" name="__codelineno-code-output-2"></a> &lt;Transformer('text.embeddings.clip', description='Embed text using 'openai/clip-vit-base-patch32'.')&gt;,
</span><span id="__span-code-output-3"><a href="#__codelineno-code-output-3" id="__codelineno-code-output-3" name="__codelineno-code-output-3"></a> &lt;Transformer('text.embeddings.minilm', description='Text embeddings using "sentence-transformers/all-MiniLM-L6-v2"')&gt;,
</span><span id="__span-code-output-4"><a href="#__codelineno-code-output-4" id="__codelineno-code-output-4" name="__codelineno-code-output-4"></a> &lt;Transformer('text.embeddings.openai-3-large', description='Text embeddings using OpenAI's "text-embedding-3-large" model')&gt;,
</span><span id="__span-code-output-5"><a href="#__codelineno-code-output-5" id="__codelineno-code-output-5" name="__codelineno-code-output-5"></a> &lt;Transformer('text.embeddings.openai-3-small', description='Text embeddings using OpenAI's "text-embedding-3-small" model')&gt;,
</span><span id="__span-code-output-6"><a href="#__codelineno-code-output-6" id="__codelineno-code-output-6" name="__codelineno-code-output-6"></a> &lt;Transformer('text.embeddings.openai-ada-002', description='OpenAI text embeddings using model text-embedding-ada-002')&gt;]
</span></code></pre></div>
<h3 id="create-binding">Create binding</h3>
<p>We'll create a binding that will process images added to our <strong><code>images_tutorial</code></strong> collection using the CLIP image
embeddings transformer, and store the results in <strong><code>image_tutorial_index</code></strong>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">binding</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">create_binding</span><span class="p">(</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="n">collection_name</span><span class="o">=</span><span class="s1">'images_tutorial'</span><span class="p">,</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span class="n">transformer_id</span><span class="o">=</span><span class="s1">'image.embeddings.clip'</span><span class="p">,</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="n">index_id</span><span class="o">=</span><span class="s1">'image_tutorial_index'</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="p">)</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="n">binding</span>
</span></code></pre></div>
<div class="language-text no-copy result highlight" id="code-output"><pre><span></span><code><span id="__span-code-output-1"><a href="#__codelineno-code-output-1" id="__codelineno-code-output-1" name="__codelineno-code-output-1"></a>&lt;Binding(id=3, status=ON, collection='images_tutorial', transformer='image.embeddings.clip', index='image_tutorial_index')&gt;
</span></code></pre></div>
<h2 id="upload-images-to-the-collection">Upload images to the collection</h2>
<p>Let's upload some images from the <a href="https://huggingface.co/datasets/shabani1/image-text-demo">image-text-demo dataset</a> to the collection. This dataset is from HuggingFace
datasets and requires the <code>datasets</code> package to be installed.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="err">!</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">datasets</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># import test data from HuggingFace datasets - requires `pip install datasets`</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="n">data</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">"shabani1/image-text-demo"</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">"train"</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-text no-copy result highlight" id="code-output"><pre><span></span><code><span id="__span-code-output-1"><a href="#__codelineno-code-output-1" id="__codelineno-code-output-1" name="__codelineno-code-output-1"></a>21
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># add documents to the collection</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">'text'</span><span class="p">])</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>    <span class="n">lx</span><span class="o">.</span><span class="n">upload_documents</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">'image'</span><span class="p">],</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>                        <span class="n">filenames</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'.jpg'</span><span class="p">,</span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a>                        <span class="n">collection_name</span><span class="o">=</span><span class="s1">'images_tutorial'</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-text no-copy result highlight" id="code-output"><pre><span></span><code><span id="__span-code-output-1"><a href="#__codelineno-code-output-1" id="__codelineno-code-output-1" name="__codelineno-code-output-1"></a>1 aerial shot of futuristic city with large motorway
</span><span id="__span-code-output-2"><a href="#__codelineno-code-output-2" id="__codelineno-code-output-2" name="__codelineno-code-output-2"></a>2 aerial shot of modern city at sunrise
</span><span id="__span-code-output-3"><a href="#__codelineno-code-output-3" id="__codelineno-code-output-3" name="__codelineno-code-output-3"></a>3 butterfly landing on the nose of a cat
</span><span id="__span-code-output-4"><a href="#__codelineno-code-output-4" id="__codelineno-code-output-4" name="__codelineno-code-output-4"></a>4 cute kitten walking through long grass
</span><span id="__span-code-output-5"><a href="#__codelineno-code-output-5" id="__codelineno-code-output-5" name="__codelineno-code-output-5"></a>5 fluffy dog sticking out tongue with yellow background
</span><span id="__span-code-output-6"><a href="#__codelineno-code-output-6" id="__codelineno-code-output-6" name="__codelineno-code-output-6"></a>6 futuristic city with led lit tower blocks
</span><span id="__span-code-output-7"><a href="#__codelineno-code-output-7" id="__codelineno-code-output-7" name="__codelineno-code-output-7"></a>7 futuristic wet city street after rain with red and blue lights
</span><span id="__span-code-output-8"><a href="#__codelineno-code-output-8" id="__codelineno-code-output-8" name="__codelineno-code-output-8"></a>8 ginger striped cat with long whiskers laid on wooden table
</span><span id="__span-code-output-9"><a href="#__codelineno-code-output-9" id="__codelineno-code-output-9" name="__codelineno-code-output-9"></a>9 happy dog walking through park area holding ball
</span><span id="__span-code-output-10"><a href="#__codelineno-code-output-10" id="__codelineno-code-output-10" name="__codelineno-code-output-10"></a>10 happy ginger dog sticking out its tongue sat in front of dirt path
</span><span id="__span-code-output-11"><a href="#__codelineno-code-output-11" id="__codelineno-code-output-11" name="__codelineno-code-output-11"></a>11 happy small fluffy white dog running across grass
</span><span id="__span-code-output-12"><a href="#__codelineno-code-output-12" id="__codelineno-code-output-12" name="__codelineno-code-output-12"></a>12 kitten raising paw to sky with cyan background
</span><span id="__span-code-output-13"><a href="#__codelineno-code-output-13" id="__codelineno-code-output-13" name="__codelineno-code-output-13"></a>13 modern city skyline at sunrise with pink to blue sky
</span><span id="__span-code-output-14"><a href="#__codelineno-code-output-14" id="__codelineno-code-output-14" name="__codelineno-code-output-14"></a>14 modern neon lit city alleyway
</span><span id="__span-code-output-15"><a href="#__codelineno-code-output-15" id="__codelineno-code-output-15" name="__codelineno-code-output-15"></a>15 new york city street view with yellow cabs
</span><span id="__span-code-output-16"><a href="#__codelineno-code-output-16" id="__codelineno-code-output-16" name="__codelineno-code-output-16"></a>16 puppy with big ears sat with orange background
</span><span id="__span-code-output-17"><a href="#__codelineno-code-output-17" id="__codelineno-code-output-17" name="__codelineno-code-output-17"></a>17 suburban area with city skyline in distance
</span><span id="__span-code-output-18"><a href="#__codelineno-code-output-18" id="__codelineno-code-output-18" name="__codelineno-code-output-18"></a>18 three young dogs on dirt road
</span><span id="__span-code-output-19"><a href="#__codelineno-code-output-19" id="__codelineno-code-output-19" name="__codelineno-code-output-19"></a>19 top down shot of black and white cat with yellow background
</span><span id="__span-code-output-20"><a href="#__codelineno-code-output-20" id="__codelineno-code-output-20" name="__codelineno-code-output-20"></a>20 two dogs playing in the snow
</span><span id="__span-code-output-21"><a href="#__codelineno-code-output-21" id="__codelineno-code-output-21" name="__codelineno-code-output-21"></a>21 two dogs running on dirt path
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># check the collection</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="n">images_tutorial</span><span class="o">.</span><span class="n">list_documents</span><span class="p">()</span>
</span></code></pre></div>
<div class="language-text no-copy result highlight" id="code-output"><pre><span></span><code><span id="__span-code-output-1"><a href="#__codelineno-code-output-1" id="__codelineno-code-output-1" name="__codelineno-code-output-1"></a>[&lt;Document("&lt;Image(aerial shot of futuristic city with large motorway.jpg)&gt;")&gt;,
</span><span id="__span-code-output-2"><a href="#__codelineno-code-output-2" id="__codelineno-code-output-2" name="__codelineno-code-output-2"></a> &lt;Document("&lt;Image(aerial shot of modern city at sunrise.jpg)&gt;")&gt;,
</span><span id="__span-code-output-3"><a href="#__codelineno-code-output-3" id="__codelineno-code-output-3" name="__codelineno-code-output-3"></a> &lt;Document("&lt;Image(butterfly landing on the nose of a cat.jpg)&gt;")&gt;,
</span><span id="__span-code-output-4"><a href="#__codelineno-code-output-4" id="__codelineno-code-output-4" name="__codelineno-code-output-4"></a> &lt;Document("&lt;Image(cute kitten walking through long grass.jpg)&gt;")&gt;,
</span><span id="__span-code-output-5"><a href="#__codelineno-code-output-5" id="__codelineno-code-output-5" name="__codelineno-code-output-5"></a> &lt;Document("&lt;Image(fluffy dog sticking out tongue with yellow background.jpg)&gt;")&gt;,
</span><span id="__span-code-output-6"><a href="#__codelineno-code-output-6" id="__codelineno-code-output-6" name="__codelineno-code-output-6"></a> &lt;Document("&lt;Image(futuristic city with led lit tower blocks.jpg)&gt;")&gt;,
</span><span id="__span-code-output-7"><a href="#__codelineno-code-output-7" id="__codelineno-code-output-7" name="__codelineno-code-output-7"></a> &lt;Document("&lt;Image(futuristic wet city street after rain with red and blue lights.jpg)&gt;")&gt;,
</span><span id="__span-code-output-8"><a href="#__codelineno-code-output-8" id="__codelineno-code-output-8" name="__codelineno-code-output-8"></a> &lt;Document("&lt;Image(ginger striped cat with long whiskers laid on wooden table.jpg)&gt;")&gt;,
</span><span id="__span-code-output-9"><a href="#__codelineno-code-output-9" id="__codelineno-code-output-9" name="__codelineno-code-output-9"></a> &lt;Document("&lt;Image(happy dog walking through park area holding ball.jpg)&gt;")&gt;,
</span><span id="__span-code-output-10"><a href="#__codelineno-code-output-10" id="__codelineno-code-output-10" name="__codelineno-code-output-10"></a> &lt;Document("&lt;Image(happy ginger dog sticking out its tongue sat in front of dirt path.jpg)&gt;")&gt;,
</span><span id="__span-code-output-11"><a href="#__codelineno-code-output-11" id="__codelineno-code-output-11" name="__codelineno-code-output-11"></a> &lt;Document("&lt;Image(happy small fluffy white dog running across grass.jpg)&gt;")&gt;,
</span><span id="__span-code-output-12"><a href="#__codelineno-code-output-12" id="__codelineno-code-output-12" name="__codelineno-code-output-12"></a> &lt;Document("&lt;Image(kitten raising paw to sky with cyan background.jpg)&gt;")&gt;,
</span><span id="__span-code-output-13"><a href="#__codelineno-code-output-13" id="__codelineno-code-output-13" name="__codelineno-code-output-13"></a> &lt;Document("&lt;Image(modern city skyline at sunrise with pink to blue sky.jpg)&gt;")&gt;,
</span><span id="__span-code-output-14"><a href="#__codelineno-code-output-14" id="__codelineno-code-output-14" name="__codelineno-code-output-14"></a> &lt;Document("&lt;Image(modern neon lit city alleyway.jpg)&gt;")&gt;,
</span><span id="__span-code-output-15"><a href="#__codelineno-code-output-15" id="__codelineno-code-output-15" name="__codelineno-code-output-15"></a> &lt;Document("&lt;Image(new york city street view with yellow cabs.jpg)&gt;")&gt;,
</span><span id="__span-code-output-16"><a href="#__codelineno-code-output-16" id="__codelineno-code-output-16" name="__codelineno-code-output-16"></a> &lt;Document("&lt;Image(puppy with big ears sat with orange background.jpg)&gt;")&gt;,
</span><span id="__span-code-output-17"><a href="#__codelineno-code-output-17" id="__codelineno-code-output-17" name="__codelineno-code-output-17"></a> &lt;Document("&lt;Image(suburban area with city skyline in distance.jpg)&gt;")&gt;,
</span><span id="__span-code-output-18"><a href="#__codelineno-code-output-18" id="__codelineno-code-output-18" name="__codelineno-code-output-18"></a> &lt;Document("&lt;Image(three young dogs on dirt road.jpg)&gt;")&gt;,
</span><span id="__span-code-output-19"><a href="#__codelineno-code-output-19" id="__codelineno-code-output-19" name="__codelineno-code-output-19"></a> &lt;Document("&lt;Image(top down shot of black and white cat with yellow background.jpg)&gt;")&gt;,
</span><span id="__span-code-output-20"><a href="#__codelineno-code-output-20" id="__codelineno-code-output-20" name="__codelineno-code-output-20"></a> &lt;Document("&lt;Image(two dogs playing in the snow.jpg)&gt;")&gt;,
</span><span id="__span-code-output-21"><a href="#__codelineno-code-output-21" id="__codelineno-code-output-21" name="__codelineno-code-output-21"></a> &lt;Document("&lt;Image(two dogs running on dirt path.jpg)&gt;")&gt;]
</span></code></pre></div>
<h2 id="query-index">Query index</h2>
<p>Let's first define some helper functions to display our image results.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">import</span> <span class="nn">httpx</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="k">def</span> <span class="nf">image_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="k">def</span> <span class="nf">display_results_html</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>    <span class="n">html_content</span> <span class="o">=</span> <span class="s2">""</span>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">'document'</span><span class="p">]</span>
</span><span id="__span-17-14"><a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>        <span class="n">thumbnail_url</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">thumbnail_url</span>
</span><span id="__span-17-15"><a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a>        <span class="n">fname</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'filename'</span><span class="p">)</span>
</span><span id="__span-17-16"><a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a>        <span class="n">score</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"score: </span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s1">'distance'</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-17-17"><a href="#__codelineno-17-17" id="__codelineno-17-17" name="__codelineno-17-17"></a>        <span class="c1"># Creating a row for each result with image on the left and text on the right</span>
</span><span id="__span-17-18"><a href="#__codelineno-17-18" id="__codelineno-17-18" name="__codelineno-17-18"></a>        <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"""</span>
</span><span id="__span-17-19"><a href="#__codelineno-17-19" id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="s2">        &lt;div style='display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;'&gt;</span>
</span><span id="__span-17-20"><a href="#__codelineno-17-20" id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="s2">            &lt;img src='</span><span class="si">{</span><span class="n">thumbnail_url</span><span class="si">}</span><span class="s2">' style='width: auto; height: auto; margin-right: 20px;'/&gt;</span>
</span><span id="__span-17-21"><a href="#__codelineno-17-21" id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="s2">            &lt;div&gt;</span>
</span><span id="__span-17-22"><a href="#__codelineno-17-22" id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="s2">                &lt;p&gt;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
</span><span id="__span-17-23"><a href="#__codelineno-17-23" id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="s2">                &lt;p&gt;</span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
</span><span id="__span-17-24"><a href="#__codelineno-17-24" id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="s2">            &lt;/div&gt;</span>
</span><span id="__span-17-25"><a href="#__codelineno-17-25" id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="s2">        &lt;/div&gt;</span>
</span><span id="__span-17-26"><a href="#__codelineno-17-26" id="__codelineno-17-26" name="__codelineno-17-26"></a><span class="s2">        """</span>
</span><span id="__span-17-27"><a href="#__codelineno-17-27" id="__codelineno-17-27" name="__codelineno-17-27"></a>    <span class="c1"># Display all results as HTML</span>
</span><span id="__span-17-28"><a href="#__codelineno-17-28" id="__codelineno-17-28" name="__codelineno-17-28"></a>    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html_content</span><span class="p">))</span>
</span></code></pre></div>
<h3 id="query-by-text">Query by text</h3>
<p>We can query our index by text to find matching images.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_text</span><span class="o">=</span><span class="s1">'best friends'</span><span class="p">,</span> <span class="n">return_document</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="n">display_results_html</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span></code></pre></div>
<div class="result" id="code-output">
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/two%20dogs%20playing%20in%20the%20snow.jpg" style="width: auto; height: auto; margin-right: 20px;">
<div>
<p>two dogs playing in the snow.jpg</p>
<p>score: 13.4786</p>
</div>
</img></div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/three%20young%20dogs%20on%20dirt%20road.jpg" style="width: auto; height: auto; margin-right: 20px;">
<div>
<p>three young dogs on dirt road.jpg</p>
<p>score: 13.8796</p>
</div>
</img></div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/two%20dogs%20running%20on%20dirt%20path.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>two dogs running on dirt path.jpg</p>
<p>score: 13.9199</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/happy%20ginger%20dog%20sticking%20out%20its%20tongue%20sat%20in%20front%20of%20dirt%20path.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>happy ginger dog sticking out its tongue sat in front of dirt path.jpg</p>
<p>score: 14.1915</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/ginger%20striped%20cat%20with%20long%20whiskers%20laid%20on%20wooden%20table.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>ginger striped cat with long whiskers laid on wooden table.jpg</p>
<p>score: 14.2613</p>
</div>
</div>
</div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_text</span><span class="o">=</span><span class="s1">'gotham city'</span><span class="p">,</span> <span class="n">return_document</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="n">display_results_html</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span></code></pre></div>
<div class="result" id="code-output">
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/aerial%20shot%20of%20modern%20city%20at%20sunrise.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>aerial shot of modern city at sunrise.jpg</p>
<p>score: 12.9919</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/suburban%20area%20with%20city%20skyline%20in%20distance.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>suburban area with city skyline in distance.jpg</p>
<p>score: 13.0167</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/modern%20city%20skyline%20at%20sunrise%20with%20pink%20to%20blue%20sky.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>modern city skyline at sunrise with pink to blue sky.jpg</p>
<p>score: 13.0856</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/aerial%20shot%20of%20futuristic%20city%20with%20large%20motorway.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>aerial shot of futuristic city with large motorway.jpg</p>
<p>score: 13.2318</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/futuristic%20wet%20city%20street%20after%20rain%20with%20red%20and%20blue%20lights.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>futuristic wet city street after rain with red and blue lights.jpg</p>
<p>score: 13.2840</p>
</div>
</div>
</div>
<h3 id="query-by-image">Query by image</h3>
<p>We can also query our index by image to find matching images.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="n">img</span> <span class="o">=</span> <span class="n">image_from_url</span><span class="p">(</span><span class="s1">'https://getlexy.com/assets/images/dalle-agi.jpeg'</span><span class="p">)</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="n">img</span>
</span></code></pre></div>
<div class="result" id="code-output">
<img src="https://getlexy.com/assets/images/dalle-agi.jpeg" style="width: auto; height: auto; margin-right: 20px; margin-top: 20px; margin-bottom: 20px;"/>
</div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_image</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">return_document</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="n">display_results_html</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span></code></pre></div>
<div class="result" id="code-output">
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/butterfly%20landing%20on%20the%20nose%20of%20a%20cat.jpg" style="width: auto; height: auto; margin-right: 20px;">
<div>
<p>butterfly landing on the nose of a cat.jpg</p>
<p>score: 8.9913</p>
</div>
</img></div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/puppy%20with%20big%20ears%20sat%20with%20orange%20background.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>puppy with big ears sat with orange background.jpg</p>
<p>score: 9.2752</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/fluffy%20dog%20sticking%20out%20tongue%20with%20yellow%20background.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>fluffy dog sticking out tongue with yellow background.jpg</p>
<p>score: 9.3786</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/two%20dogs%20running%20on%20dirt%20path.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>two dogs running on dirt path.jpg</p>
<p>score: 9.5351</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/cute%20kitten%20walking%20through%20long%20grass.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>cute kitten walking through long grass.jpg</p>
<p>score: 9.6472</p>
</div>
</div>
</div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">img</span> <span class="o">=</span> <span class="n">image_from_url</span><span class="p">(</span><span class="s1">'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Night_in_the_Greater_Tokyo_Area_ISS054.jpg/2560px-Night_in_the_Greater_Tokyo_Area_ISS054.jpg'</span><span class="p">)</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="n">img</span>
</span></code></pre></div>
<div class="result" id="code-output">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Night_in_the_Greater_Tokyo_Area_ISS054.jpg/2560px-Night_in_the_Greater_Tokyo_Area_ISS054.jpg" style="width: auto; height: auto; margin-right: 20px; margin-top: 20px; margin-bottom: 20px;"/>
</div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_image</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">return_document</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="n">display_results_html</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span></code></pre></div>
<div class="result" id="code-output">
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/suburban%20area%20with%20city%20skyline%20in%20distance.jpg" style="width: auto; height: auto; margin-right: 20px;">
<div>
<p>suburban area with city skyline in distance.jpg</p>
<p>score: 7.7127</p>
</div>
</img></div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/futuristic%20city%20with%20led%20lit%20tower%20blocks.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>futuristic city with led lit tower blocks.jpg</p>
<p>score: 8.0037</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/aerial%20shot%20of%20futuristic%20city%20with%20large%20motorway.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>aerial shot of futuristic city with large motorway.jpg</p>
<p>score: 8.3442</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/modern%20city%20skyline%20at%20sunrise%20with%20pink%20to%20blue%20sky.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>modern city skyline at sunrise with pink to blue sky.jpg</p>
<p>score: 8.4371</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/aerial%20shot%20of%20modern%20city%20at%20sunrise.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>aerial shot of modern city at sunrise.jpg</p>
<p>score: 8.9889</p>
</div>
</div>
</div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">img</span> <span class="o">=</span> <span class="n">image_from_url</span><span class="p">(</span><span class="s1">'https://upload.wikimedia.org/wikipedia/commons/e/ed/Shanghai_skyline_2018</span><span class="si">%28c</span><span class="s1">ropped%29.jpg'</span><span class="p">)</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="n">img</span>
</span></code></pre></div>
<div class="result" id="code-output">
<img src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Shanghai_skyline_2018%28cropped%29.jpg" style="width: auto; height: auto; margin-right: 20px; margin-top: 20px; margin-bottom: 20px;"/>
</div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">results</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_image</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">return_document</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">display_results_html</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span></code></pre></div>
<div class="result" id="code-output">
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/aerial%20shot%20of%20futuristic%20city%20with%20large%20motorway.jpg" style="width: auto; height: auto; margin-right: 20px;">
<div>
<p>aerial shot of futuristic city with large motorway.jpg</p>
<p>score: 6.2110</p>
</div>
</img></div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/futuristic%20city%20with%20led%20lit%20tower%20blocks.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>futuristic city with led lit tower blocks.jpg</p>
<p>score: 6.7713</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/aerial%20shot%20of%20modern%20city%20at%20sunrise.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>aerial shot of modern city at sunrise.jpg</p>
<p>score: 7.0736</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/modern%20city%20skyline%20at%20sunrise%20with%20pink%20to%20blue%20sky.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>modern city skyline at sunrise with pink to blue sky.jpg</p>
<p>score: 7.4314</p>
</div>
</div>
<div style="display: flex; align-items: center; margin-bottom: 20px; margin-top: 20px;">
<img src="/assets/images/new%20york%20city%20street%20view%20with%20yellow%20cabs.jpg" style="width: auto; height: auto; margin-right: 20px;"/>
<div>
<p>new york city street view with yellow cabs.jpg</p>
<p>score: 7.8167</p>
</div>
</div>
</div>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.bd41221c.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>